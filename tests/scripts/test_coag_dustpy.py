import os
from constants import *
from fileIO import *
import numpy as np
import matplotlib.pyplot as plt

print("Making and running test...\n")

os.system('cd ../../ && make -j test_coagdustpy')
os.system('../../test_coagdustpy')

sim = CuDiscModel("../outputs/coag_dustpy")
sizes = sim.load_grain_sizes()
gas, dust = sim.load_prims("0")

a_dp = [5.1e-05, 5.3e-05, 5.5e-05, 5.71e-05, 5.94e-05, 6.17e-05, 6.4e-05, 6.65e-05, 6.91e-05, 7.18e-05, 7.46e-05, 7.74e-05, 8.04e-05, 8.36e-05, 8.68e-05, 9.02e-05, 9.37e-05, 9.73e-05, 0.000101, 0.000105, 0.000109, 0.000113, 0.000118, 0.000122, 0.000127, 0.000132, 0.000137, 0.000142, 0.000148, 0.000153, 0.000159, 0.000166, 0.000172, 0.000179, 0.000186, 0.000193, 0.0002, 0.000208, 0.000216, 0.000224, 0.000233, 0.000242, 0.000252, 0.000261, 0.000271, 0.000282, 0.000293, 0.000304, 0.000316, 0.000328, 0.000341, 0.000354, 0.000368, 0.000382, 0.000397, 0.000412, 0.000428, 0.000445, 0.000462, 0.00048, 0.000499, 0.000518, 0.000538, 0.000559, 0.00058, 0.000603, 0.000626, 0.000651, 0.000676, 0.000702, 0.000729, 0.000757, 0.000787, 0.000817, 0.000849, 0.000882, 0.000916, 0.000951, 0.000988, 0.00103, 0.00107, 0.00111, 0.00115, 0.0012, 0.00124, 0.00129, 0.00134, 0.00139, 0.00145, 0.0015, 0.00156, 0.00162, 0.00168, 0.00175, 0.00182, 0.00189, 0.00196, 0.00203, 0.00211, 0.0022, 0.00228, 0.00237, 0.00246, 0.00256, 0.00265, 0.00276, 0.00286, 0.00298, 0.00309, 0.00321, 0.00333, 0.00346, 0.0036, 0.00374, 0.00388, 0.00403, 0.00419, 0.00435, 0.00452, 0.00469, 0.00488, 0.00507, 0.00526, 0.00547, 0.00568, 0.0059, 0.00613, 0.00636, 0.00661, 0.00686, 0.00713, 0.00741, 0.00769, 0.00799, 0.0083, 0.00862, 0.00896, 0.0093, 0.00966, 0.01, 0.0104, 0.0108, 0.0113, 0.0117, 0.0121, 0.0126, 0.0131, 0.0136, 0.0141, 0.0147, 0.0152, 0.0158, 0.0165, 0.0171, 0.0178, 0.0184, 0.0192, 0.0199, 0.0207, 0.0215, 0.0223, 0.0232, 0.0241, 0.025, 0.026, 0.027, 0.028, 0.0291, 0.0302, 0.0314, 0.0326, 0.0339, 0.0352, 0.0365, 0.038, 0.0394, 0.041, 0.0425, 0.0442, 0.0459, 0.0477, 0.0495, 0.0515, 0.0534, 0.0555, 0.0577, 0.0599, 0.0622, 0.0646, 0.0671, 0.0697, 0.0724, 0.0752, 0.0782, 0.0812, 0.0843, 0.0876, 0.091, 0.0945, 0.0982]
sigma_dp = [0.015, 0.0095, 0.00783, 0.00695, 0.00638, 0.00598, 0.00592, 0.00586, 0.00567, 0.00553, 0.00539, 0.00533, 0.00522, 0.00515, 0.00513, 0.00507, 0.00503, 0.00499, 0.00497, 0.00497, 0.00498, 0.00497, 0.00497, 0.00497, 0.00498, 0.00499, 0.00501, 0.00502, 0.00504, 0.00507, 0.00509, 0.00512, 0.00515, 0.00518, 0.00522, 0.00525, 0.00529, 0.00533, 0.00537, 0.00542, 0.00546, 0.00551, 0.00556, 0.0056, 0.00565, 0.00571, 0.00576, 0.00581, 0.00587, 0.00593, 0.00599, 0.00605, 0.00611, 0.00617, 0.00623, 0.0063, 0.00636, 0.00643, 0.0065, 0.00657, 0.00663, 0.0067, 0.00678, 0.00685, 0.00692, 0.00699, 0.00706, 0.00713, 0.0076, 0.00757, 0.00756, 0.00756, 0.00757, 0.00759, 0.00762, 0.00765, 0.00768, 0.00771, 0.00775, 0.00779, 0.00782, 0.00785, 0.00789, 0.00792, 0.00794, 0.00796, 0.00798, 0.00799, 0.00799, 0.00799, 0.00798, 0.00797, 0.00794, 0.00791, 0.00787, 0.00782, 0.00775, 0.00768, 0.00681, 0.00616, 0.00583, 0.00571, 0.00573, 0.00586, 0.00606, 0.00629, 0.00654, 0.0068, 0.00708, 0.00736, 0.00764, 0.00793, 0.00822, 0.00852, 0.00883, 0.00915, 0.00947, 0.00981, 0.0102, 0.0105, 0.0109, 0.0113, 0.0118, 0.0122, 0.0127, 0.0132, 0.0138, 0.0143, 0.0149, 0.0155, 0.0162, 0.0169, 0.0175, 0.0183, 0.019, 0.0197, 0.0205, 0.0213, 0.022, 0.0228, 0.0235, 0.0242, 0.0248, 0.0252, 0.0255, 0.0256, 0.0254, 0.0249, 0.0241, 0.023, 0.0216, 0.0199, 0.017, 0.0142, 0.0117, 0.00934, 0.0072, 0.00532, 0.00376, 0.00253, 0.00161, 0.000961, 0.000537, 0.000279, 0.000133, 5.86e-05, 2.34e-05, 8.41e-06, 2.71e-06, 7.75e-07, 1.95e-07, 4.31e-08, 8.27e-09, 1.38e-09, 1.99e-10, 2.49e-11, 2.72e-12, 2.61e-13, 2.23e-14, 1.71e-15, 1.19e-16, 7.55e-18, 4.39e-19, 2.34e-20, 1.15e-21, 5.23e-23, 2.19e-24, 8.43e-26, 3e-27, 9.88e-29, 2.95e-30, 1.99e-32, 2.23e-32, 2.5e-32, 2.8e-32, 3.14e-32, 3.52e-32, 3.94e-32, 4.42e-32, 4.95e-32]

print("Generating plots...")

# def a(m):
#     return (3.*m/(1.6 * 4.* np.pi) )**(1./3.)
# a_dp = a(data.m[-1])

fig,ax1 = plt.subplots(figsize = (5,3.5))

ax1.loglog(a_dp, sigma_dp, label='DustPy')

ax1.loglog(sizes.a_c, sizes.m_c*dust.rho[2,2,:]/np.diff(sizes.m_e),label= 'cuDisc', ls='--', c='r')

ax1.set_ylim(2e-3,5e-2)
# plt.ylim(1e-25, 1e-14)
plt.xlim(6e-5, 3e-2)
ax1.set_ylabel(r"$\sigma_d$(m) (g cm$^{-2}$)")
plt.xlabel(r"Grain size (cm)")
plt.legend()
plt.tight_layout()
plt.savefig("../outputs/coag_dustpy/dustpycomp_0D.png")

print("Done!\n")


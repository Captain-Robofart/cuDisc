import os
from constants import *
from fileIO import *
import numpy as np
import matplotlib.pyplot as plt

print("Making and running test...\n")

os.system('cd ../../ && make -j test_coagdustpy')
os.system('../../test_coagdustpy')

sim = CuDiscModel("../outputs/coag_dustpy")
sizes = sim.load_grain_sizes()
gas, dust = sim.load_dens1D("0")

a_dp = [5e-05, 5.19e-05, 5.4e-05, 5.61e-05, 5.83e-05, 6.05e-05, 6.29e-05, 6.53e-05, 6.79e-05, 7.05e-05, 7.33e-05, 7.61e-05, 7.91e-05, 8.22e-05, 8.53e-05, 8.87e-05, 9.21e-05, 9.57e-05, 9.94e-05, 0.000103, 0.000107, 0.000112, 0.000116, 0.00012, 0.000125, 0.00013, 0.000135, 0.00014, 0.000146, 0.000151, 0.000157, 0.000163, 0.00017, 0.000176, 0.000183, 0.00019, 0.000198, 0.000205, 0.000213, 0.000222, 0.00023, 0.000239, 0.000249, 0.000258, 0.000268, 0.000279, 0.00029, 0.000301, 0.000313, 0.000325, 0.000338, 0.000351, 0.000364, 0.000379, 0.000393, 0.000409, 0.000425, 0.000441, 0.000458, 0.000476, 0.000495, 0.000514, 0.000534, 0.000555, 0.000576, 0.000599, 0.000622, 0.000646, 0.000671, 0.000698, 0.000725, 0.000753, 0.000782, 0.000813, 0.000844, 0.000877, 0.000911, 0.000947, 0.000984, 0.00102, 0.00106, 0.0011, 0.00115, 0.00119, 0.00124, 0.00129, 0.00134, 0.00139, 0.00144, 0.0015, 0.00156, 0.00162, 0.00168, 0.00174, 0.00181, 0.00188, 0.00196, 0.00203, 0.00211, 0.00219, 0.00228, 0.00237, 0.00246, 0.00256, 0.00266, 0.00276, 0.00287, 0.00298, 0.00309, 0.00321, 0.00334, 0.00347, 0.0036, 0.00374, 0.00389, 0.00404, 0.0042, 0.00436, 0.00453, 0.00471, 0.00489, 0.00508, 0.00528, 0.00549, 0.0057, 0.00592, 0.00615, 0.00639, 0.00664, 0.0069, 0.00717, 0.00745, 0.00774, 0.00804, 0.00835, 0.00868, 0.00901, 0.00937, 0.00973, 0.0101, 0.0105, 0.0109, 0.0113, 0.0118, 0.0122, 0.0127, 0.0132, 0.0137, 0.0143, 0.0148, 0.0154, 0.016, 0.0166, 0.0173, 0.0179, 0.0186, 0.0194, 0.0201, 0.0209, 0.0217, 0.0225, 0.0234, 0.0243, 0.0253, 0.0263, 0.0273, 0.0284, 0.0295, 0.0306, 0.0318, 0.033, 0.0343, 0.0357, 0.037, 0.0385, 0.04, 0.0415, 0.0432, 0.0448, 0.0466, 0.0484, 0.0503, 0.0522, 0.0543, 0.0564, 0.0586, 0.0609, 0.0632, 0.0657, 0.0683, 0.0709, 0.0737, 0.0765, 0.0795, 0.0826, 0.0858, 0.0892, 0.0926, 0.0963, 0.1] 
sigma_dp = [0.0134, 0.00831, 0.00685, 0.00608, 0.00558, 0.00523, 0.00526, 0.00515, 0.00499, 0.00488, 0.00476, 0.00468, 0.00459, 0.00452, 0.0045, 0.00443, 0.00439, 0.00436, 0.00433, 0.00434, 0.00433, 0.00432, 0.00432, 0.00431, 0.00432, 0.00432, 0.00433, 0.00435, 0.00436, 0.00438, 0.0044, 0.00442, 0.00444, 0.00447, 0.00449, 0.00452, 0.00455, 0.00459, 0.00462, 0.00465, 0.00469, 0.00473, 0.00476, 0.0048, 0.00484, 0.00489, 0.00493, 0.00497, 0.00502, 0.00506, 0.00511, 0.00516, 0.00521, 0.00526, 0.00531, 0.00536, 0.00541, 0.00547, 0.00552, 0.00558, 0.00563, 0.00569, 0.00575, 0.00581, 0.00586, 0.00592, 0.00598, 0.00604, 0.00638, 0.00636, 0.00636, 0.00636, 0.00638, 0.0064, 0.00643, 0.00646, 0.00649, 0.00652, 0.00656, 0.0066, 0.00663, 0.00667, 0.0067, 0.00673, 0.00676, 0.00678, 0.00681, 0.00682, 0.00684, 0.00685, 0.00685, 0.00685, 0.00684, 0.00683, 0.0068, 0.00677, 0.00674, 0.00669, 0.00605, 0.00554, 0.00529, 0.0052, 0.00524, 0.00536, 0.00554, 0.00575, 0.00597, 0.0062, 0.00643, 0.00667, 0.00691, 0.00715, 0.00739, 0.00763, 0.00787, 0.00812, 0.00836, 0.0086, 0.00885, 0.00911, 0.00936, 0.00963, 0.0099, 0.0102, 0.0105, 0.0108, 0.0111, 0.0115, 0.0118, 0.0122, 0.0126, 0.013, 0.0134, 0.0139, 0.0143, 0.0148, 0.0153, 0.0159, 0.0164, 0.017, 0.0176, 0.0182, 0.0188, 0.0195, 0.0201, 0.0208, 0.0215, 0.0223, 0.023, 0.0238, 0.0247, 0.0259, 0.0256, 0.0252, 0.0248, 0.0243, 0.0236, 0.0225, 0.0212, 0.0196, 0.0178, 0.0157, 0.0135, 0.0113, 0.00915, 0.00713, 0.00533, 0.00381, 0.00259, 0.00167, 0.00101, 0.000574, 0.000303, 0.000148, 6.6e-05, 2.69e-05, 9.87e-06, 3.26e-06, 9.54e-07, 2.47e-07, 5.59e-08, 1.1e-08, 1.89e-09, 2.8e-10, 3.6e-11, 4.02e-12, 3.94e-13, 3.42e-14, 2.66e-15, 1.86e-16, 1.19e-17, 6.94e-19, 3.71e-20, 1.82e-21, 8.26e-23, 3.44e-24, 1.32e-25, 4.66e-27, 1.52e-28, 4.56e-30]

print("Generating plots...")

# def a(m):
#     return (3.*m/(1.6 * 4.* np.pi) )**(1./3.)
# a_dp = a(data.m[-1])

fig,ax1 = plt.subplots(figsize = (5,3.5))

ax1.loglog(a_dp, sigma_dp, label='DustPy')

ax1.loglog(sizes.a_c, sizes.m_c*dust.Sigma[2,:]/np.diff(sizes.m_e),label= 'cuDisc', ls='--', c='r')

ax1.set_ylim(2e-3,5e-2)
# plt.ylim(1e-25, 1e-14)
plt.xlim(6e-5, 5e-2)
ax1.set_ylabel(r"$\sigma_d$(m) (g cm$^{-2}$)")
plt.xlabel(r"Grain size (cm)")
plt.legend()
plt.tight_layout()
plt.savefig("../outputs/coag_dustpy/dustpycomp_0D.png")

print("Done!\n")

